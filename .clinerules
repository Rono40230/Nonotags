# Nonotags - RÃ¨gles Essentielles de DÃ©veloppement
# âš ï¸ IMPÃ‰RATIF - Ne JAMAIS enfreindre ces rÃ¨gles

## âš ï¸ RÃˆGLES DE COMPORTEMENT CRITIQUE

**PROFIL UTILISATEUR : Non-codeur - Claude modifie directement les fichiers dans VSCode**

### ğŸ¯ RÃˆGLES D'OR (INVIOLABLES)

1. **Ne JAMAIS casser le code existant**
   - âœ… Tester l'impact sur le code existant AVANT toute modification
   - âœ… Si une modification risque de casser quelque chose : DEMANDER confirmation
   - âŒ AUCUNE modification du code fonctionnel sans approbation explicite
   - âœ… **AVERTIR** clairement si une modification touche du code sensible
   - âœ… Compiler aprÃ¨s chaque modification : `python -m py_compile <fichier.py>`

2. **ZÃ©ro initiative non sollicitÃ©e**
   - âŒ INTERDICTION ABSOLUE de proposer des "amÃ©liorations" non demandÃ©es
   - âŒ Ne JAMAIS refactoriser sans demande explicite
   - âŒ Ne JAMAIS "optimiser" le code sans instruction
   - âœ… Faire UNIQUEMENT ce qui est demandÃ©, rien de plus
   - âœ… **EXCEPTION** : Signaler briÃ¨vement bugs CRITIQUES ou opportunitÃ©s >30% performance

3. **Communication pour non-codeurs**
   - âœ… **MODIFICATIONS DIRECTES** : Claude modifie les fichiers directement dans VSCode
   - âœ… **FEEDBACK MINIMAL** : AprÃ¨s modification, message court type "âœ… ModifiÃ© : [fichier]"
   - âœ… **EXPLICATIONS CIBLÃ‰ES** : Expliquer uniquement dÃ©cisions importantes
   - âŒ **PAS de rÃ©sumÃ©** dÃ©taillÃ© (l'utilisateur voit les changements dans VSCode)
   - âŒ **PAS de jargon** technique non expliquÃ©

4. **Gestion des bugs rÃ©currents**
   - âœ… AprÃ¨s **5 tentatives Ã©chouÃ©es** sur la mÃªme correction : CHANGER DE STRATÃ‰GIE
   - âœ… ReconnaÃ®tre explicitement : "âŒ Ma logique est incorrecte, je teste une autre approche"
   - âœ… **EXPLIQUER** briÃ¨vement pourquoi la nouvelle approche est diffÃ©rente (2-3 lignes max)
   - âœ… Proposer UNE alternative radicalement diffÃ©rente

5. **Architecture modulaire OBLIGATOIRE**
   - âœ… RESPECTER l'architecture existante : core/ â†’ services/ â†’ ui/
   - âœ… Chaque fonctionnalitÃ© dans son propre module
   - âœ… Single Responsibility Principle : un module = une responsabilitÃ©
   - âŒ JAMAIS crÃ©er de structure ad-hoc sans validation

### Format de rÃ©ponse OBLIGATOIRE

**Pour une modification simple (95% des cas) :**
```
âœ… ModifiÃ© : `ui/views/album_edit_window.py`
```

**Pour une modification avec point important :**
```
âœ… ModifiÃ© : `core/metadata_backup.py`

ğŸ’¡ Utilise maintenant SQLite pour persistance des mÃ©tadonnÃ©es originales.
```

**Pour correction aprÃ¨s erreur :**
```
âœ… CorrigÃ© : `services/audio_converter.py`
```

**Pour bug rÃ©current (5+ Ã©checs) :**
```
âŒ Ma logique threading ne fonctionne pas.
Nouvelle approche : utiliser GLib.idle_add() pour synchroniser l'UI.

âœ… ModifiÃ© : `ui/views/audio_converter_window.py`
```

**Pour demander confirmation avant modification sensible :**
```
âš ï¸ Cette modification va toucher `ui/main_app.py` utilisÃ© par 8 modules.
Risque de casser le code existant.

Veux-tu que je continue ?
```

---

## ğŸ—ï¸ Architecture Nonotags (STRUCTURÃ‰ ET STRICT)

### Structure imposÃ©e
```
Nonotags/
â”œâ”€â”€ core/                # Logique mÃ©tier (file_renamer, metadata_processor, etc.)
â”œâ”€â”€ database/            # Couche donnÃ©es (db_manager, models)
â”œâ”€â”€ services/            # Services mÃ©tier (audio_player, music_scanner, audio_converter)
â”œâ”€â”€ support/             # Utilitaires (logger, config_manager, validator)
â”œâ”€â”€ ui/                  # Interface GTK3
â”‚   â”œâ”€â”€ components/      # Composants rÃ©utilisables
â”‚   â”œâ”€â”€ managers/        # Gestionnaires (window_manager, persistent_window_manager)
â”‚   â”œâ”€â”€ views/           # FenÃªtres principales
â”‚   â”œâ”€â”€ resources/       # Ressources (CSS, images)
â”‚   â””â”€â”€ transitions/     # Transitions entre Ã©crans
â”œâ”€â”€ logs/                # Fichiers de log
â””â”€â”€ .clinerules          # CES RÃˆGLES
```

### Patterns archÃ©ologiques Ã  respecter STRICTEMENT
- **Modules sÃ©parÃ©s** : Chaque fonctionnalitÃ© = nouveau fichier
- **Callbacks GTK3** : Convention `on_<action>_<element>` OBLIGATOIRE
- **Threading** : GLib.idle_add() pour mise Ã  jour UI depuis threads
- **MÃ©tadonnÃ©es** : Mutagen PARTOUT (jamais autre chose)
- **Bases de donnÃ©es** : SQLite avec pattern factory

### Nommage STRICT
- **Fichiers Python** : snake_case (ex: metadata_backup.py)
- **Classes** : PascalCase (ex: AudioConverter, AlbumEditWindow)
- **Fonctions/MÃ©thodes** : snake_case (ex: _add_files_to_list)
- **Constantes** : UPPER_SNAKE_CASE (ex: SUPPORTED_FORMATS)
- **Attributs privÃ©s** : PrÃ©fixe underscore (ex: self._internal_state)

---

## ğŸ”§ STANDARDS TECHNIQUES (OBLIGATOIRES)

### Python
- **Version** : Python 3.11+
- **Indentation** : 4 espaces (JAMAIS tabs)
- **Encodage** : UTF-8 obligatoire
- **Imports** : Standard library â†’ third-party â†’ local
- **Docstrings** : Toutes les classes et fonctions publiques
- **Type hints** : Fortement recommandÃ©s pour API publiques

### GTK3 UI
- **Compilation** : `python -m py_compile <fichier.py>` APRÃˆS chaque modification
- **Threads** : GLib.idle_add() pour mettre Ã  jour l'UI depuis threads
- **Widgets** : Classes Gtk3 standards UNIQUEMENT
- **Callbacks** : Convention stricte `on_<action>_<element>`

### Audio & MÃ©tadonnÃ©es
- **Formats** : .mp3, .flac, .m4a, .mp4, .wav, .ogg
- **BibliothÃ¨que** : Mutagen TOUJOURS (jamais autre chose)
  - ID3 pour MP3
  - FLAC pour FLAC
  - MP4 pour M4A/MP4
- **Erreurs** : Capturer exceptions Mutagen spÃ©cifiquement

### Logging & Feedback
- **FranÃ§ais** : Commentaires + logs en franÃ§ais
- **Format** : Logs avec emojis (âœ… succÃ¨s, âŒ erreurs, âš ï¸ avertissements)
- **Jamais** : `print()` pour logs â†’ utiliser print() pour feedback utilisateur
- **ClartÃ©** : Les commentaires expliquent le POURQUOI, pas le QUOI

## ğŸ“ CONVENTIONS DE DOCUMENTS

### Commentaires
- **FranÃ§ais** : Commentaires et docstrings en franÃ§ais
- **ClartÃ©** : Les commentaires expliquent le POURQUOI, pas le QUOI
- **Logs** : Utiliser print() avec emojis pour feedback utilisateur
- **Debug** : PrÃ©fixe âŒ pour erreurs, âœ… pour succÃ¨s, âš ï¸ pour avertissements

### Exemple de structure
```python
"""
Description courte du module
Description plus dÃ©taillÃ©e des fonctionnalitÃ©s principales
"""

import os
from typing import List, Dict, Optional
from mutagen.flac import FLAC

class AudioProcessor:
    """Traite les fichiers audio"""
    
    def __init__(self):
        self.supported_formats = ['.mp3', '.flac', '.m4a']
    
    def process_file(self, file_path: str) -> Dict:
        """
        Traite un fichier audio
        
        Args:
            file_path: Chemin du fichier Ã  traiter
            
        Returns:
            Dictionnaire avec les mÃ©tadonnÃ©es extraites
        """
        if not os.path.exists(file_path):
            print(f"âŒ Fichier introuvable: {file_path}")
            return {}
        
        # Extraction des mÃ©tadonnÃ©es
        metadata = self._extract_metadata(file_path)
        return metadata
```

---

## âœ… Checklist avant chaque commit

- [ ] Code compile sans erreurs : `python -m py_compile <fichier.py>`
- [ ] Pas de code dupliquÃ©
- [ ] Pas de hardcoding (credentials, paths)
- [ ] Logs clairs avec emojis
- [ ] Gestion d'erreurs complÃ¨te
- [ ] **VÃ‰RIFIÃ‰** : Aucun code existant cassÃ©
- [ ] **VÃ‰RIFIÃ‰** : Architecture modulaire respectÃ©e
- [ ] **VÃ‰RIFIÃ‰** : Git status clean
- [ ] Message de commit descriptif
- [ ] Tests manuels effectuÃ©s sur la fonctionnalitÃ©

---

## ğŸš« Interdictions strictes (Ne JAMAIS)

### Ã€ INTERDIRE ABSOLUMENT
- âŒ Credentials/API keys en dur
- âŒ Hardcoding de chemins (utiliser config_manager)
- âŒ Code dupliquÃ© entre modules
- âŒ Import with * (`from module import *`)
- âŒ Variables globales mutables
- âŒ Modifications du code existant sans approbation
- âŒ Refactorisation non demandÃ©e
- âŒ Suppression de fonctionnalitÃ© sans documentation
- âŒ Threading SANS GLib.idle_add() pour l'UI
- âŒ Mutagen non utilisÃ© pour mÃ©tadonnÃ©es audio
